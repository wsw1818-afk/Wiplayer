<Window x:Class="Wiplayer.Views.MultiPlayerWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="{Binding Title}"
        Height="800" Width="1200"
        MinHeight="600" MinWidth="800"
        Background="{StaticResource BackgroundDarkBrush}"
        WindowStyle="SingleBorderWindow"
        AllowDrop="True"
        Drop="Window_Drop"
        DragOver="Window_DragOver"
        PreviewKeyDown="Window_PreviewKeyDown"
        MouseMove="Window_MouseMove">

    <Grid x:Name="MainGrid">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 4분할 비디오 영역 -->
        <Grid Grid.Row="0" x:Name="VideoGrid">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- 플레이어 1 (좌상단) -->
            <Border Grid.Row="0" Grid.Column="0"
                    BorderBrush="{Binding Players[0].IsSelected, Converter={StaticResource BoolToBorderBrushConverter}}"
                    BorderThickness="2" Margin="2">
                <Grid Background="Black"
                      MouseLeftButtonDown="PlayerPanel_MouseLeftButtonDown"
                      Tag="0"
                      AllowDrop="True"
                      Drop="PlayerPanel_Drop"
                      DragOver="PlayerPanel_DragOver">
                    <!-- 비디오 프레임 -->
                    <Image Source="{Binding Players[0].VideoFrame}"
                           Stretch="Uniform"
                           RenderOptions.BitmapScalingMode="HighQuality"/>

                    <!-- 플레이어 번호 표시 -->
                    <TextBlock Text="1" FontSize="24" FontWeight="Bold"
                               Foreground="#80FFFFFF"
                               HorizontalAlignment="Left" VerticalAlignment="Top"
                               Margin="10"/>

                    <!-- 파일 안내 (미디어 없을 때) -->
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                                Visibility="{Binding Players[0].HasMedia, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                        <TextBlock Text="&#xE8A5;" FontFamily="Segoe MDL2 Assets" FontSize="48"
                                   Foreground="#40FFFFFF" HorizontalAlignment="Center"/>
                        <TextBlock Text="파일을 드래그" Foreground="#40FFFFFF" FontSize="14" Margin="0,8,0,0"/>
                    </StackPanel>

                    <!-- 미니 컨트롤 -->
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Bottom" HorizontalAlignment="Center"
                                Margin="5" Opacity="0.8"
                                Visibility="{Binding ShowControls, Converter={StaticResource BoolToVisibilityConverter}}">
                        <Button Style="{StaticResource MiniPlayerButtonStyle}"
                                Command="{Binding Players[0].OpenFileCommand}"
                                Content="&#xE8E5;" ToolTip="파일 열기"/>
                        <Button Style="{StaticResource MiniPlayerButtonStyle}"
                                Command="{Binding Players[0].PlayPauseCommand}"
                                Content="{Binding Players[0].IsPlaying, Converter={StaticResource PlayPauseIconConverter}}"
                                ToolTip="재생/일시정지"/>
                        <Button Style="{StaticResource MiniPlayerButtonStyle}"
                                Command="{Binding Players[0].StopCommand}"
                                Content="&#xE71A;" ToolTip="정지"/>
                        <Button Style="{StaticResource MiniPlayerButtonStyle}"
                                Command="{Binding Players[0].ToggleMuteCommand}"
                                Content="{Binding Players[0].IsMuted, Converter={StaticResource VolumeIconConverter}}"
                                ToolTip="음소거"/>
                    </StackPanel>

                    <!-- 시간 표시 -->
                    <TextBlock VerticalAlignment="Bottom" HorizontalAlignment="Right" Margin="10"
                               Foreground="#80FFFFFF" FontSize="12">
                        <Run Text="{Binding Players[0].PositionText}"/>
                        <Run Text=" / "/>
                        <Run Text="{Binding Players[0].DurationText}"/>
                    </TextBlock>
                </Grid>
            </Border>

            <!-- 플레이어 2 (우상단) -->
            <Border Grid.Row="0" Grid.Column="1"
                    BorderBrush="{Binding Players[1].IsSelected, Converter={StaticResource BoolToBorderBrushConverter}}"
                    BorderThickness="2" Margin="2">
                <Grid Background="Black"
                      MouseLeftButtonDown="PlayerPanel_MouseLeftButtonDown"
                      Tag="1"
                      AllowDrop="True"
                      Drop="PlayerPanel_Drop"
                      DragOver="PlayerPanel_DragOver">
                    <Image Source="{Binding Players[1].VideoFrame}"
                           Stretch="Uniform"
                           RenderOptions.BitmapScalingMode="HighQuality"/>

                    <TextBlock Text="2" FontSize="24" FontWeight="Bold"
                               Foreground="#80FFFFFF"
                               HorizontalAlignment="Left" VerticalAlignment="Top"
                               Margin="10"/>

                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                                Visibility="{Binding Players[1].HasMedia, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                        <TextBlock Text="&#xE8A5;" FontFamily="Segoe MDL2 Assets" FontSize="48"
                                   Foreground="#40FFFFFF" HorizontalAlignment="Center"/>
                        <TextBlock Text="파일을 드래그" Foreground="#40FFFFFF" FontSize="14" Margin="0,8,0,0"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" VerticalAlignment="Bottom" HorizontalAlignment="Center"
                                Margin="5" Opacity="0.8"
                                Visibility="{Binding ShowControls, Converter={StaticResource BoolToVisibilityConverter}}">
                        <Button Style="{StaticResource MiniPlayerButtonStyle}"
                                Command="{Binding Players[1].OpenFileCommand}"
                                Content="&#xE8E5;" ToolTip="파일 열기"/>
                        <Button Style="{StaticResource MiniPlayerButtonStyle}"
                                Command="{Binding Players[1].PlayPauseCommand}"
                                Content="{Binding Players[1].IsPlaying, Converter={StaticResource PlayPauseIconConverter}}"
                                ToolTip="재생/일시정지"/>
                        <Button Style="{StaticResource MiniPlayerButtonStyle}"
                                Command="{Binding Players[1].StopCommand}"
                                Content="&#xE71A;" ToolTip="정지"/>
                        <Button Style="{StaticResource MiniPlayerButtonStyle}"
                                Command="{Binding Players[1].ToggleMuteCommand}"
                                Content="{Binding Players[1].IsMuted, Converter={StaticResource VolumeIconConverter}}"
                                ToolTip="음소거"/>
                    </StackPanel>

                    <TextBlock VerticalAlignment="Bottom" HorizontalAlignment="Right" Margin="10"
                               Foreground="#80FFFFFF" FontSize="12">
                        <Run Text="{Binding Players[1].PositionText}"/>
                        <Run Text=" / "/>
                        <Run Text="{Binding Players[1].DurationText}"/>
                    </TextBlock>
                </Grid>
            </Border>

            <!-- 플레이어 3 (좌하단) -->
            <Border Grid.Row="1" Grid.Column="0"
                    BorderBrush="{Binding Players[2].IsSelected, Converter={StaticResource BoolToBorderBrushConverter}}"
                    BorderThickness="2" Margin="2">
                <Grid Background="Black"
                      MouseLeftButtonDown="PlayerPanel_MouseLeftButtonDown"
                      Tag="2"
                      AllowDrop="True"
                      Drop="PlayerPanel_Drop"
                      DragOver="PlayerPanel_DragOver">
                    <Image Source="{Binding Players[2].VideoFrame}"
                           Stretch="Uniform"
                           RenderOptions.BitmapScalingMode="HighQuality"/>

                    <TextBlock Text="3" FontSize="24" FontWeight="Bold"
                               Foreground="#80FFFFFF"
                               HorizontalAlignment="Left" VerticalAlignment="Top"
                               Margin="10"/>

                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                                Visibility="{Binding Players[2].HasMedia, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                        <TextBlock Text="&#xE8A5;" FontFamily="Segoe MDL2 Assets" FontSize="48"
                                   Foreground="#40FFFFFF" HorizontalAlignment="Center"/>
                        <TextBlock Text="파일을 드래그" Foreground="#40FFFFFF" FontSize="14" Margin="0,8,0,0"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" VerticalAlignment="Bottom" HorizontalAlignment="Center"
                                Margin="5" Opacity="0.8"
                                Visibility="{Binding ShowControls, Converter={StaticResource BoolToVisibilityConverter}}">
                        <Button Style="{StaticResource MiniPlayerButtonStyle}"
                                Command="{Binding Players[2].OpenFileCommand}"
                                Content="&#xE8E5;" ToolTip="파일 열기"/>
                        <Button Style="{StaticResource MiniPlayerButtonStyle}"
                                Command="{Binding Players[2].PlayPauseCommand}"
                                Content="{Binding Players[2].IsPlaying, Converter={StaticResource PlayPauseIconConverter}}"
                                ToolTip="재생/일시정지"/>
                        <Button Style="{StaticResource MiniPlayerButtonStyle}"
                                Command="{Binding Players[2].StopCommand}"
                                Content="&#xE71A;" ToolTip="정지"/>
                        <Button Style="{StaticResource MiniPlayerButtonStyle}"
                                Command="{Binding Players[2].ToggleMuteCommand}"
                                Content="{Binding Players[2].IsMuted, Converter={StaticResource VolumeIconConverter}}"
                                ToolTip="음소거"/>
                    </StackPanel>

                    <TextBlock VerticalAlignment="Bottom" HorizontalAlignment="Right" Margin="10"
                               Foreground="#80FFFFFF" FontSize="12">
                        <Run Text="{Binding Players[2].PositionText}"/>
                        <Run Text=" / "/>
                        <Run Text="{Binding Players[2].DurationText}"/>
                    </TextBlock>
                </Grid>
            </Border>

            <!-- 플레이어 4 (우하단) -->
            <Border Grid.Row="1" Grid.Column="1"
                    BorderBrush="{Binding Players[3].IsSelected, Converter={StaticResource BoolToBorderBrushConverter}}"
                    BorderThickness="2" Margin="2">
                <Grid Background="Black"
                      MouseLeftButtonDown="PlayerPanel_MouseLeftButtonDown"
                      Tag="3"
                      AllowDrop="True"
                      Drop="PlayerPanel_Drop"
                      DragOver="PlayerPanel_DragOver">
                    <Image Source="{Binding Players[3].VideoFrame}"
                           Stretch="Uniform"
                           RenderOptions.BitmapScalingMode="HighQuality"/>

                    <TextBlock Text="4" FontSize="24" FontWeight="Bold"
                               Foreground="#80FFFFFF"
                               HorizontalAlignment="Left" VerticalAlignment="Top"
                               Margin="10"/>

                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                                Visibility="{Binding Players[3].HasMedia, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                        <TextBlock Text="&#xE8A5;" FontFamily="Segoe MDL2 Assets" FontSize="48"
                                   Foreground="#40FFFFFF" HorizontalAlignment="Center"/>
                        <TextBlock Text="파일을 드래그" Foreground="#40FFFFFF" FontSize="14" Margin="0,8,0,0"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" VerticalAlignment="Bottom" HorizontalAlignment="Center"
                                Margin="5" Opacity="0.8"
                                Visibility="{Binding ShowControls, Converter={StaticResource BoolToVisibilityConverter}}">
                        <Button Style="{StaticResource MiniPlayerButtonStyle}"
                                Command="{Binding Players[3].OpenFileCommand}"
                                Content="&#xE8E5;" ToolTip="파일 열기"/>
                        <Button Style="{StaticResource MiniPlayerButtonStyle}"
                                Command="{Binding Players[3].PlayPauseCommand}"
                                Content="{Binding Players[3].IsPlaying, Converter={StaticResource PlayPauseIconConverter}}"
                                ToolTip="재생/일시정지"/>
                        <Button Style="{StaticResource MiniPlayerButtonStyle}"
                                Command="{Binding Players[3].StopCommand}"
                                Content="&#xE71A;" ToolTip="정지"/>
                        <Button Style="{StaticResource MiniPlayerButtonStyle}"
                                Command="{Binding Players[3].ToggleMuteCommand}"
                                Content="{Binding Players[3].IsMuted, Converter={StaticResource VolumeIconConverter}}"
                                ToolTip="음소거"/>
                    </StackPanel>

                    <TextBlock VerticalAlignment="Bottom" HorizontalAlignment="Right" Margin="10"
                               Foreground="#80FFFFFF" FontSize="12">
                        <Run Text="{Binding Players[3].PositionText}"/>
                        <Run Text=" / "/>
                        <Run Text="{Binding Players[3].DurationText}"/>
                    </TextBlock>
                </Grid>
            </Border>
        </Grid>

        <!-- 글로벌 컨트롤 바 (하단) -->
        <Grid Grid.Row="1" Background="{StaticResource ControlBarGradient}" Height="50"
              Visibility="{Binding ShowControls, Converter={StaticResource BoolToVisibilityConverter}}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- 왼쪽: 전체 컨트롤 -->
            <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="16,0">
                <Button Style="{StaticResource PlayerButtonStyle}"
                        Command="{Binding PlayAllCommand}"
                        Content="&#xE768;" ToolTip="모두 재생"/>
                <Button Style="{StaticResource PlayerButtonStyle}"
                        Command="{Binding PauseAllCommand}"
                        Content="&#xE769;" ToolTip="모두 일시정지"/>
                <Button Style="{StaticResource PlayerButtonStyle}"
                        Command="{Binding StopAllCommand}"
                        Content="&#xE71A;" ToolTip="모두 정지"/>
            </StackPanel>

            <!-- 중앙: 선택된 플레이어 정보 -->
            <StackPanel Grid.Column="1" Orientation="Horizontal"
                        HorizontalAlignment="Center" VerticalAlignment="Center">
                <TextBlock Foreground="{StaticResource TextPrimaryBrush}" FontSize="14">
                    <Run Text="선택: 플레이어 "/>
                    <Run Text="{Binding SelectedPlayer.PanelNumber}"/>
                    <Run Text=" - "/>
                    <Run Text="{Binding SelectedPlayer.Title}"/>
                </TextBlock>
            </StackPanel>

            <!-- 오른쪽: 윈도우 컨트롤 -->
            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center" Margin="16,0">
                <Button Style="{StaticResource PlayerButtonStyle}"
                        Command="{Binding ToggleFullscreenCommand}"
                        Content="&#xE740;" ToolTip="전체화면 (F)"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
